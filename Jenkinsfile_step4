pipeline {
  agent {
        label 'ContainerS'
  }
   environment {
      	GIT_CREDENTIAL = 'pass_github'
   }

   stages {

	stage('Checkout') {
            steps {
	          	checkout scm
	    }
        }

	stage('install Helm and K8s') {
            steps {
                script {
		    sh "docker build -t giosuemanzo/flask-app-example:${env.IMAGE_TAG} ."
		    } 

	       } 
          }

stage('Login and clone') {
            steps {
                    script {
                        //git branch: 'main', credentialsId: 'pass_github', url: 'https://github.com/giosuesource/formazione_sou_k8s'
                        git url: 'https://github.com/giosuesource/formazione_sou_k8s', branch: 'main'   
                        sh "git pull chart main"

			}
                    }
                }
      }
}
